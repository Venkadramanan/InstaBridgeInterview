function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(e){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module))?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}((function(e){e.defineOption("autoCloseTags",!1,(function(a,l,s){if(s!=e.Init&&s&&a.removeKeyMap("autoCloseTags"),l){var f={name:"autoCloseTags"};"object"==_typeof(l)&&!1===l.whenClosing||(f["'/'"]=function(t){return function(t){return t.getOption("disableInput")?e.Pass:o(t,!0)}(t)}),"object"==_typeof(l)&&!1===l.whenOpening||(f["'>'"]=function(o){return function(o){if(o.getOption("disableInput"))return e.Pass;for(var a=o.listSelections(),l=[],s=o.getOption("autoCloseTags"),f=0;f<a.length;f++){if(!a[f].empty())return e.Pass;var d=a[f].head,u=o.getTokenAt(d),c=e.innerMode(o.getMode(),u.state),g=c.state,m=c.mode.xmlCurrentTag&&c.mode.xmlCurrentTag(g),p=m&&m.name;if(!p)return e.Pass;var h="html"==c.mode.configuration,y="object"==_typeof(s)&&s.dontCloseTags||h&&t,b="object"==_typeof(s)&&s.indentTags||h&&n;u.end>d.ch&&(p=p.slice(0,p.length-u.end+d.ch));var C=p.toLowerCase();if(!p||"string"==u.type&&(u.end!=d.ch||!/[\"\']/.test(u.string.charAt(u.string.length-1))||1==u.string.length)||"tag"==u.type&&m.close||u.string.indexOf("/")==d.ch-u.start-1||y&&r(y,C)>-1||i(o,c.mode.xmlCurrentContext&&c.mode.xmlCurrentContext(g)||[],p,d,!0))return e.Pass;var v="object"==_typeof(s)&&s.emptyTags;if(v&&r(v,p)>-1)l[f]={text:"/>",newPos:e.Pos(d.line,d.ch+2)};else{var x=b&&r(b,C)>-1;l[f]={indent:x,text:">"+(x?"\n\n":"")+"</"+p+">",newPos:x?e.Pos(d.line+1,0):e.Pos(d.line,d.ch+1)}}}var P="object"==_typeof(s)&&s.dontIndentOnAutoClose;for(f=a.length-1;f>=0;f--){var T=l[f];o.replaceRange(T.text,a[f].head,a[f].anchor,"+insert");var S=o.listSelections().slice(0);S[f]={head:T.newPos,anchor:T.newPos},o.setSelections(S),!P&&T.indent&&(o.indentLine(T.newPos.line,null,!0),o.indentLine(T.newPos.line+1,null,!0))}}(o)}),a.addKeyMap(f)}}));var t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],n=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];function o(t,n){for(var o=t.listSelections(),r=[],a=n?"/":"</",l=t.getOption("autoCloseTags"),s="object"==_typeof(l)&&l.dontIndentOnSlash,f=0;f<o.length;f++){if(!o[f].empty())return e.Pass;var d=o[f].head,u=t.getTokenAt(d),c=e.innerMode(t.getMode(),u.state),g=c.state;if(n&&("string"==u.type||"<"!=u.string.charAt(0)||u.start!=d.ch-1))return e.Pass;var m,p="xml"!=c.mode.name&&"htmlmixed"==t.getMode().name;if(p&&"javascript"==c.mode.name)m=a+"script";else if(p&&"css"==c.mode.name)m=a+"style";else{var h=c.mode.xmlCurrentContext&&c.mode.xmlCurrentContext(g),y=h.length?h[h.length-1]:"";if(!h||h.length&&i(t,h,y,d))return e.Pass;m=a+y}">"!=t.getLine(d.line).charAt(u.end)&&(m+=">"),r[f]=m}if(t.replaceSelections(r),o=t.listSelections(),!s)for(f=0;f<o.length;f++)(f==o.length-1||o[f].head.line<o[f+1].head.line)&&t.indentLine(o[f].head.line)}function r(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;++n)if(e[n]==t)return n;return-1}function i(t,n,o,r,i){if(!e.scanForClosingTag)return!1;var a=Math.min(t.lastLine()+1,r.line+500),l=e.scanForClosingTag(t,r,null,a);if(!l||l.tag!=o)return!1;for(var s=i?1:0,f=n.length-1;f>=0&&n[f]==o;f--)++s;r=l.to;for(f=1;f<s;f++){var d=e.scanForClosingTag(t,r,null,a);if(!d||d.tag!=o)return!1;r=d.to}return!0}e.commands.closeTag=function(e){return o(e)}}));
